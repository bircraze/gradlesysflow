project.ext {
    prop = { p ->
        return properties[p] ? properties[p] : ""
    }
    replaceMap = { srcMap, replaceKey, inMap ->
        // println "inMap" + inMap
        def index = srcMap.findIndexOf{it.key == replaceKey}
        def preMap = [:]
        def postMap = [:]
        srcMap.eachWithIndex { entry, i ->
            if (i < index) {
                preMap << entry
            } else if (i > index) {
                postMap << entry
            }
        }
        return preMap + inMap + postMap 
    }

    tpl_env_example = [
        parties: genSubList(), 
        steps: [
            sysclean: [
                rootonly: true,
                cmd: "echo",
                subcmd: "",
                args: ["hi", "hi2"]
            ],
            reset: [
                parallel: true,
                cmd: "git",
                subcmd: "reset",
                args: ["--hard"]
            ],
            checkout: [
                parallel: true,
                cmd: "git",
                subcmd: "checkout",
                args: [":::tag:::"],
                tag: "OVERRIDE" 
            ],
            hook: [
                rootonly: true
            ],
            mytest: [
                parallel: true,
                cmd: "gradle",
                subcmd: "myTask",
                args: ["-Pdummy=${prop('dummy')}", "-Pver=:::ver:::", "-Petc=:::etc:::"],
                ver: "OVERRIDE",
                etc: "OVERRIDE"
            ]
        ]
    ]
}

def genSubList() {
    def subArr = []
    for (each in subprojects) {
        subArr.add((String) each)
    }
    
    return subArr.collect { it.split(":")[1].replaceAll("\'", "") }
}
